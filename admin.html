<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Administraci√≥n de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .hidden { display: none; }
        .loader { text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const passwordCorrecta = ""; // Cambia esta contrase√±a
            const pass = prompt("Ingrese la contrase√±a de administrador:");
            if (pass !== passwordCorrecta) {
                document.body.innerHTML = "<h2 class='text-center text-danger mt-5'>Acceso denegado</h2>";
            }
        });
    </script>

    <div class="container" id="admin-panel">
        <h1 class="my-4 text-center">Administraci√≥n de Productos</h1>
        <div class="loader hidden" id="loader"><span class="loader"></span></div>
        <div id="productos-container"></div>
        <p id="mensaje" class="text-center mt-3"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('productos-container');
            const loader = document.getElementById('loader');
            const mensaje = document.getElementById('mensaje');
            const SHEET_URL = 'https://opensheet.elk.sh/1oVfG1dhrkutkOWe7hELdONDnQyRTtSYITpoYHvpTZLQ/menu';

            function cargarProductos() {
                loader.classList.remove('hidden'); // Muestra el loader mientras carga
                fetch(SHEET_URL)
                    .then(response => response.json())
                    .then(data => {
                        console.log("üì• Datos recibidos de Google Sheets:", data); // DEBUG

                        const productos = data.map(row => ({
                            nombre: row.Nombre || "Sin nombre",
                            descripcion: row.Descripci√≥n || "Sin descripci√≥n",
                            precio: row.Precio ? parseFloat(row.Precio) : 0,
                            imagen: row.Imagen && row.Imagen.trim() !== "" ? row.Imagen : "https://via.placeholder.com/150",
                            categoria: row.Categor√≠a || "Sin categor√≠a",
                            activo: row.Activo === "SI"
                        }));

                        localStorage.setItem('productos', JSON.stringify(productos));
                        renderizarProductos(productos);
                        loader.classList.add('hidden'); // Oculta el loader
                        mensaje.innerHTML = "‚úÖ Productos actualizados correctamente.";
                    })
                    .catch(error => {
                        console.error('‚ùå Error al obtener los productos:', error);
                        loader.classList.add('hidden'); // Oculta el loader en caso de error
                        mensaje.innerHTML = "‚ùå Error al cargar productos.";
                    });
            }

            function renderizarProductos(products) {
                container.innerHTML = "";
                const activos = products.filter(product => product.activo);
                if (activos.length === 0) {
                    container.innerHTML = "<p>No hay productos disponibles.</p>";
                    return;
                }
                const categories = {};
                activos.forEach(product => {
                    if (!categories[product.categoria]) categories[product.categoria] = [];
                    categories[product.categoria].push(product);
                });

                for (const cat in categories) {
                    const catSection = document.createElement('div');
                    catSection.classList.add("mb-4");
                    catSection.innerHTML = `<h3>${cat}</h3>`;
                    categories[cat].forEach(product => {
                        const productDiv = document.createElement('div');
                        productDiv.className = "producto d-flex align-items-center mb-3 p-3 border rounded";
                        productDiv.innerHTML = `
                            <img src="${product.imagen}" class="img-fluid me-3" alt="${product.nombre}" style="width: 80px; height: 80px; object-fit: cover;">
                            <div>
                                <h5>${product.nombre}</h5>
                                <p class="text-muted">${product.descripcion}</p>
                            </div>
                            <strong class="ms-auto">$${product.precio.toFixed(2)}</strong>
                        `;
                        catSection.appendChild(productDiv);
                    });
                    container.appendChild(catSection);
                }
            }

            // üöÄ Cargar productos autom√°ticamente al entrar
            cargarProductos();
        });
    </script>
</body>
</html>
